<!-- templates/courses/student_courses.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Каталог курсов{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- Мои курсы -->
            {% if user.is_authenticated and my_courses %}
            <section id="my-courses" class="mb-5">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="h4 mb-0">
                        <i class="fas fa-book-open text-success me-2"></i>
                        Мои курсы
                    </h2>
                    <span class="badge bg-success">Всего курсов: {{ my_courses|length }}</span>
                </div>

                <div class="row">
                    {% for course in my_courses %}
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card h-100 course-card shadow-sm">
                            <div class="card-header bg-success text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0">{{ course.title }}</h5>
                                    <span class="badge bg-light text-success">{{ course.get_difficulty_level_display }}</span>
                                </div>
                            </div>
                            
                            <div class="card-body d-flex flex-column">
                                <p class="card-text flex-grow-1">{{ course.description|truncatewords:25 }}</p>
                                
                                <!-- Прогресс -->
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <small class="text-muted">Прогресс</small>
                                        <small class="text-muted">{{ course.progress_percentage }}%</small>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-success" 
                                             role="progressbar" 
                                             aria-valuenow="{{ course.progress_percentage }}" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                        </div>
                                    </div>
                                </div>

                                <!-- Информация о курсе -->
                                <div class="course-meta mb-3">
                                    <div class="row small text-muted">
                                        <div class="col-6">
                                            <i class="fas fa-clock me-1"></i>
                                            {{ course.duration_weeks }} нед.
                                        </div>
                                        <div class="col-6">
                                            <i class="fas fa-users me-1"></i>
                                            {{ course.student_count }} студ.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-footer bg-transparent">
                                <div class="d-grid gap-2">
                                    <a href="{% url 'course_detail' course.course_id %}" 
                                       class="btn btn-success btn-sm">
                                        <i class="fas fa-play-circle me-1"></i>
                                        Продолжить обучение
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.course-card {
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
}

.course-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    border-color: #007bff;
}

.course-meta i {
    width: 16px;
    text-align: center;
}

.progress {
    background-color: #e9ecef;
    border-radius: 4px;
}

.progress-bar {
    border-radius: 4px;
    transition: width 0.6s ease;
}

.badge {
    font-size: 0.7em;
}

.card-header {
    border-bottom: 1px solid rgba(0,0,0,0.125);
}

.course-stats {
    border-top: 1px solid #f8f9fa;
    padding-top: 10px;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Плавная прокрутка к секциям
    const navLinks = document.querySelectorAll('a[href^="#"]');
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Анимация появления карточек
    const courseCards = document.querySelectorAll('.course-card');
    courseCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Подсветка активной секции при прокрутке
    const sections = document.querySelectorAll('section');
    const navItems = document.querySelectorAll('.btn-group .btn');
    
    function highlightActiveSection() {
        const scrollPos = window.scrollY + 100;
        
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            
            if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                const sectionId = section.getAttribute('id');
                navItems.forEach(item => {
                    if (item.getAttribute('href') === `#${sectionId}`) {
                        item.classList.remove('btn-outline-primary', 'btn-outline-success');
                        item.classList.add('btn-primary', 'btn-success');
                    } else {
                        item.classList.remove('btn-primary', 'btn-success');
                        item.classList.add('btn-outline-primary', 'btn-outline-success');
                    }
                });
            }
        });
    }
    
    window.addEventListener('scroll', highlightActiveSection);
    highlightActiveSection(); // Инициализация при загрузке
});
</script>
{% endblock %}